<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aglet Match: Shoelace Stylist</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .aglet-pulse { animation: pulse 2s infinite; }
        body { background-color: #0f172a; margin: 0; overflow: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 遊戲邏輯與設定 ---
        const GRID_SIZE = 8;
        const AGLET_TYPES = ['classic', 'metallic', 'neon', 'matte', 'textured'];

        const generateRandomAglet = () => ({
            id: Math.random().toString(36).substr(2, 9),
            type: AGLET_TYPES[Math.floor(Math.random() * AGLET_TYPES.length)],
        });

        const createBoard = () => {
            const board = [];
            for (let r = 0; r < GRID_SIZE; r++) {
                board[r] = [];
                for (let c = 0; c < GRID_SIZE; c++) {
                    let aglet = generateRandomAglet();
                    while (
                        (c >= 2 && board[r][c-1]?.type === aglet.type && board[r][c-2]?.type === aglet.type) ||
                        (r >= 2 && board[r-1][c]?.type === aglet.type && board[r-2][c]?.type === aglet.type)
                    ) { aglet = generateRandomAglet(); }
                    board[r][c] = aglet;
                }
            }
            return board;
        };

        // --- 圖示組件 ---
        const AgletIcon = ({ type, size }) => {
            const colors = {
                classic: '#94a3b8', metallic: '#fbbf24', neon: '#4ade80', matte: '#f87171', textured: '#818cf8'
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="8" y="2" width="8" height="20" rx="2" fill={colors[type] || '#ccc'} />
                    <rect x="8" y="16" width="8" height="4" fill="black" fillOpacity="0.2" />
                </svg>
            );
        };

        // --- 主程式 App ---
        const App = () => {
            const [board, setBoard] = useState([]);
            const [score, setScore] = useState(0);
            const [moves, setMoves] = useState(25);
            const [selected, setSelected] = useState(null);
            const [isProcessing, setIsProcessing] = useState(false);

            useEffect(() => { setBoard(createBoard()); }, []);

            const handleCellClick = (row, col) => {
                if (isProcessing || moves <= 0) return;
                if (!selected) { setSelected({ row, col }); } 
                else {
                    const dist = Math.abs(selected.row - row) + Math.abs(selected.col - col);
                    if (dist === 1) { swapAndProcess(selected, { row, col }); } 
                    else { setSelected({ row, col }); }
                }
            };

            const swapAndProcess = async (p1, p2) => {
                setIsProcessing(true);
                const newBoard = board.map(r => [...r]);
                [newBoard[p1.row][p1.col], newBoard[p2.row][p2.col]] = [newBoard[p2.row][p2.col], newBoard[p1.row][p1.col]];
                setBoard(newBoard);
                setSelected(null);
                setMoves(m => m - 1);
                // 這裡簡化處理匹配逻辑，實際會更複雜
                setIsProcessing(false);
            };

            return (
                <div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-4 text-white">
                    <div className="w-full max-w-md flex justify-between items-center mb-6 bg-slate-800 p-4 rounded-2xl border border-slate-700">
                        <div><span className="text-xs font-bold text-slate-400">SCORE</span><br/><span className="text-2xl font-black text-indigo-400">{score}</span></div>
                        <div className="text-center"><h1 className="text-xl font-bold">AGLET MATCH</h1><p className="text-[10px] text-slate-500">Shoelace Stylist</p></div>
                        <div className="text-right"><span className="text-xs font-bold text-slate-400">MOVES</span><br/><span className="text-2xl font-black text-emerald-400">{moves}</span></div>
                    </div>

                    <div className="relative p-2 bg-slate-800 rounded-2xl border-4 border-slate-700">
                        <div className="grid gap-1" style={{ gridTemplateColumns: `repeat(${GRID_SIZE}, 1fr)`, width: 'min(90vw, 400px)', height: 'min(90vw, 400px)' }}>
                            {board.map((row, r) => row.map((aglet, c) => (
                                <div key={aglet?.id || `${r}-${c}`} onClick={() => handleCellClick(r, c)}
                                     className={`flex items-center justify-center rounded-lg cursor-pointer transition-all ${selected?.row === r && selected?.col === c ? 'bg-indigo-500/50 ring-2 ring-indigo-400 scale-105' : 'bg-slate-700/50'}`}>
                                    {aglet && <AgletIcon type={aglet.type} size={30} />}
                                </div>
                            )))}
                        </div>
                    </div>

                    <div className="mt-8 text-slate-500 text-xs text-center max-w-xs italic">
                        Tip: Match 3 or more stylish aglets. High-end shoelace tips await your curation! 
                        <br/><span className="text-indigo-400 font-bold">Touch Fastener</span> technology enabled.
                    </div>
